# 报错处理

## 运行报错

### 1、提供 esbuild 安装失败的解决方案

```bash
Error: esbuild: Failed to install correctly

Make sure you don't have "ignore-scripts" set to true. You can check this with
"npm config get ignore-scripts". If that returns true you can reset it back to
false using "npm config set ignore-scripts false" and then reinstall esbuild.

If you're using npm v7, make sure your package-lock.json file contains either
"lockfileVersion": 1 or the code "hasInstallScript": true. If it doesn't have
either of those, then it is likely the case that a known bug in npm v7 has
corrupted your package-lock.json file. Regenerating your package-lock.json file
should fix this issue.

    at Object.<anonymous> (/Users/liyong/Desktop/code/mb-admin/node_modules/vite-plugin-mock/node_modules/esbuild/bin/esbuild:2:7)
    at Module._compile (node:internal/modules/cjs/loader:1565:14)
    at Object..js (node:internal/modules/cjs/loader:1708:10)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
    at Function._load (node:internal/modules/cjs/loader:1128:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:170:5)
    at node:internal/main/run_main_module:36:49

Node.js v22.12.0
20:33:52 [vite:mock] mock reload error Error: The service was stopped   
```

1、确保 pnpm 允许执行安装脚本

```bash
# 检查 pnpm 的 ignore-scripts 配置
pnpm config get ignore-scripts

# 如果返回 true，关闭它
pnpm config set ignore-scripts false
```

2、 删除所有依赖和锁定文件

```bash

# 删除 node_modules 和所有锁定文件（包括残留的 npm/yarn 文件）
rm -rf node_modules .pnpm-store pnpm-lock.yaml package-lock.json

# 清除 pnpm 的全局缓存（关键步骤！）
pnpm store prune

# 显式安装 esbuild 并修复依赖
pnpm add -D esbuild@0.19
pnpm add vite-plugin-mock@latest

# 重新安装依赖
pnpm install
```
